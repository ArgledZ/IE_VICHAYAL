-- MySQL Workbench Synchronization
-- Generated: 2021-10-21 01:07
-- Model: New Model
-- Version: 1.0
-- Project: Name of the project
-- Author: gcamo

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

CREATE SCHEMA IF NOT EXISTS `db_vichayal` DEFAULT CHARACTER SET utf8 ;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`ubDepartamento` (
  `idDepa` INT(11) NOT NULL,
  `departamento` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`idDepa`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`ubProvincia` (
  `idProv` INT(11) NOT NULL,
  `provincia` VARCHAR(45) NOT NULL,
  `idDepa` INT(11) NOT NULL,
  PRIMARY KEY (`idProv`),
  INDEX `PRO_DEP_idx` (`idDepa` ASC),
  CONSTRAINT `PRO_DEP`
    FOREIGN KEY (`idDepa`)
    REFERENCES `db_vichayal`.`ubDepartamento` (`idDepa`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`ubDistrito` (
  `idDist` INT(11) NOT NULL,
  `distrito` VARCHAR(45) NOT NULL,
  `idProv` INT(11) NOT NULL,
  PRIMARY KEY (`idDist`),
  INDEX `DIS_PROVI_idx` (`idProv` ASC),
  CONSTRAINT `DIS_PROVI`
    FOREIGN KEY (`idProv`)
    REFERENCES `db_vichayal`.`ubProvincia` (`idProv`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`NIVEL` (
  `NIVEL_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `NIV_DESCRIPCION` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`NIVEL_ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`GRADO` (
  `GRADO_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `GRA_DESCRIPCION` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`GRADO_ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`SECCION` (
  `SECCION_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `SEC_DESCRIPCION` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`SECCION_ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`ANNIO_ESCOLAR` (
  `ANNIO_ESCOLAR_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `ANN_INICIO` DATETIME NULL DEFAULT NULL,
  `ANN_FIN` DATETIME NULL DEFAULT NULL,
  `ANN_DESCRIPCION` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`ANNIO_ESCOLAR_ID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`APODERADO` (
  `APODERADO_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `APO_DNI` INT(8) NOT NULL,
  `APO_NOMBRES` VARCHAR(45) NOT NULL,
  `APO_APELLIDOS` VARCHAR(45) NOT NULL,
  `APO_TELEFONO` VARCHAR(45) NOT NULL,
  `APO_CORREO` VARCHAR(45) NOT NULL,
  `APO_DISTRITO` INT(11) NOT NULL,
  `APO_DIRECCION` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`APODERADO_ID`),
  INDEX `APO_DIS_idx` (`APO_DISTRITO` ASC),
  CONSTRAINT `APO_DIS`
    FOREIGN KEY (`APO_DISTRITO`)
    REFERENCES `db_vichayal`.`ubDistrito` (`idDist`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`USUARIO` (
  `USUARIO_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `USUARIO` VARCHAR(45) NOT NULL,
  `CONTRASENA` VARCHAR(45) NOT NULL,
  `TIPODEUSUARIO` INT(11) NOT NULL,
  PRIMARY KEY (`USUARIO_ID`),
  UNIQUE INDEX `USUARIO_UNIQUE` (`USUARIO` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`ADMINISTRATIVO` (
  `ADMINISTRATIVO_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `ADM_DNI` VARCHAR(45) NOT NULL,
  `ADM_NOMBRES` VARCHAR(45) NOT NULL,
  `ADM_APELLIDOS` VARCHAR(45) NOT NULL,
  `ADM_USUARIO` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`ADMINISTRATIVO_ID`),
  INDEX `ADM_USU_idx` (`ADM_USUARIO` ASC),
  CONSTRAINT `ADM_USU`
    FOREIGN KEY (`ADM_USUARIO`)
    REFERENCES `db_vichayal`.`USUARIO` (`USUARIO_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`VACANTE` (
  `VACANTE_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `ANN_ID` INT(11) NOT NULL,
  `EST_ID` INT(11) NOT NULL,
  PRIMARY KEY (`VACANTE_ID`),
  INDEX `VAC_EST_idx` (`EST_ID` ASC),
  INDEX `VAC_ANN_idx` (`ANN_ID` ASC),
  CONSTRAINT `VAC_EST`
    FOREIGN KEY (`EST_ID`)
    REFERENCES `db_vichayal`.`ESTUDIANTE` (`ESTUDIANTE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `VAC_ANN`
    FOREIGN KEY (`ANN_ID`)
    REFERENCES `db_vichayal`.`ANNIO_ESCOLAR` (`ANNIO_ESCOLAR_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;



CREATE TABLE IF NOT EXISTS `db_vichayal`.`ESTUDIANTE` (
  `ESTUDIANTE_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `EST_DNI` INT(8) NOT NULL,
  `EST_NOMBRES` VARCHAR(45) NOT NULL,
  `EST_APELLIDOS` VARCHAR(45) NOT NULL,
  `EST_FECHA` DATE NOT NULL,
  `EST_DISTRITO` INT(11) NOT NULL,
  `EST_DIRECCION` VARCHAR(45) NOT NULL,
  `APODERADO_ID` INT(11) NOT NULL,
  `EST_USUARIO` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`ESTUDIANTE_ID`),
  UNIQUE INDEX `EST_DNI_UNIQUE` (`EST_DNI` ASC),
  INDEX `APO_EST_idx` (`APODERADO_ID` ASC),
  INDEX `USU_EST_idx` (`EST_USUARIO` ASC),
  INDEX `EST_DIST_idx` (`EST_DISTRITO` ASC),
  CONSTRAINT `APO_EST`
    FOREIGN KEY (`APODERADO_ID`)
    REFERENCES `db_vichayal`.`APODERADO` (`APODERADO_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `USU_EST`
    FOREIGN KEY (`EST_USUARIO`)
    REFERENCES `db_vichayal`.`USUARIO` (`USUARIO_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `EST_DIST`
    FOREIGN KEY (`EST_DISTRITO`)
    REFERENCES `db_vichayal`.`ubDistrito` (`idDist`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

CREATE TABLE IF NOT EXISTS `db_vichayal`.`MATRICULA` (
  `MATRICULA_ID` INT(11) NOT NULL AUTO_INCREMENT,
  `ESTUDIANTE_ID` INT(11) NOT NULL,
  `ANNIO_ESCOLAR_ID` INT(11) NOT NULL,
  `NIVEL_ID` INT(11) NOT NULL,
  `GRADO_ID` INT(11) NOT NULL,
  `SECCION_ID` INT(11) NOT NULL,
  `VAC_ID` INT(11) NOT NULL,
  PRIMARY KEY (`MATRICULA_ID`),
  INDEX `EST_ID_idx` (`ESTUDIANTE_ID` ASC),
  INDEX `NIV_MAT_idx` (`NIVEL_ID` ASC),
  INDEX `GRA_MAT_idx` (`GRADO_ID` ASC),
  INDEX `SEC_MAT_idx` (`SECCION_ID` ASC),
  INDEX `ANN_MAT_idx` (`ANNIO_ESCOLAR_ID` ASC),
  INDEX `VAC_MAT_idx` (`VAC_ID` ASC),
  CONSTRAINT `EST_MAT`
    FOREIGN KEY (`ESTUDIANTE_ID`)
    REFERENCES `db_vichayal`.`ESTUDIANTE` (`ESTUDIANTE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `NIV_MAT`
    FOREIGN KEY (`NIVEL_ID`)
    REFERENCES `db_vichayal`.`NIVEL` (`NIVEL_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `GRA_MAT`
    FOREIGN KEY (`GRADO_ID`)
    REFERENCES `db_vichayal`.`GRADO` (`GRADO_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `SEC_MAT`
    FOREIGN KEY (`SECCION_ID`)
    REFERENCES `db_vichayal`.`SECCION` (`SECCION_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `ANN_MAT`
    FOREIGN KEY (`ANNIO_ESCOLAR_ID`)
    REFERENCES `db_vichayal`.`ANNIO_ESCOLAR` (`ANNIO_ESCOLAR_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `VAC_MAT`
    FOREIGN KEY (`VAC_ID`)
    REFERENCES `db_vichayal`.`VACANTE` (`VACANTE_ID`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;




DELIMITER $$

USE `db_vichayal`$$
CREATE DEFINER = CURRENT_USER TRIGGER `DB_VICHAYAL`.`ESTUDIANTE_BEFORE_INSERT` BEFORE INSERT ON `ESTUDIANTE` FOR EACH ROW
BEGIN
insert into USUARIO(USUARIO,CONTRASENA,TIPODEUSUARIO) values (new.EST_DNI,new.EST_DNI,2);
SET NEW.EST_USUARIO = (SELECT USUARIO_ID FROM USUARIO WHERE USUARIO= NEW.EST_DNI);
END$$

DELIMITER ;


DELIMITER $$

USE `db_vichayal`$$
CREATE DEFINER = CURRENT_USER TRIGGER `db_vichayal`.`ADMINISTRATIVO_BEFORE_INSERT` BEFORE INSERT ON `ADMINISTRATIVO` FOR EACH ROW
BEGIN
	insert into USUARIO(USUARIO,CONTRASENA,TIPODEUSUARIO) values (new.ADM_DNI,new.ADM_DNI,1);
	SET NEW.ADM_USUARIO = (SELECT ADMINISTRATIVO_ID FROM USUARIO WHERE USUARIO= NEW.ADM_DNI);
END$$

DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
